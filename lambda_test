import json
import boto3
import io

s3 = boto3.client('s3')

def lambda_handler(event, context):
    # TODO implement
    bucket_name = "test-cv123"
    
    # Store the keys in a list
    all_files = []
    
    # Initial call to list_objects_v2
    response = s3_client.list_objects_v2(Bucket=bucket_name)
    
    # Retrieve and store the keys
    while response:
        if 'Contents' in response:
            all_files.extend([obj['Key'] for obj in response['Contents']])
        
        # Check if there are more objects to fetch
        if response['IsTruncated']:
            # If so, fetch the next batch using the continuation token
            response = s3_client.list_objects_v2(Bucket=bucket_name, ContinuationToken=response['NextContinuationToken'])
        else:
            # No more objects to fetch, exit loop
            response = None
    
    return {
        'statusCode': 200,
        'body': {
            'message': 'List of files',
            'files': all_files
        }
    }
